---
import { getCollection } from "astro:content";
import { BaseLayout, Section } from "@/components/layouts";
import { Card, Icon } from "@/components/ui";

const posts = await getCollection("blog");

const tagCounts: Record<string, number> = {};
posts.forEach((post) => {
    post.data.tags?.forEach((tag) => {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
    });
});

const tags = Object.keys(tagCounts).sort((a, b) => a.localeCompare(b));
---

<BaseLayout title="Tags" description="View blogs by tag">
    <Section title="Tags">
        {
            tags.length > 0 ? (
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
                    {tags.map((tag) => {
                        const count = tagCounts[tag];
                        const intensity = Math.min(
                            0.3 + (count / 10) * 0.2,
                            0.9,
                        );

                        return (
                            <Card
                                as="a"
                                href={`/tags/${encodeURIComponent(tag)}`}
                                padding="lg"
                                hover
                                aria-label={`view ${count} blogs with tag ${tag}`}
                                class="flex flex-col items-center justify-center text-center aspect-square"
                            >
                                <Icon name="tag" class="size-8" />
                                <h2 class="text-xl font-semibold mb-2 break-all">
                                    {tag}
                                </h2>
                                <p class="text-sm text-muted-foreground">
                                    {count} blogs
                                </p>
                                <div class="w-16 h-1 bg-muted rounded-full mt-4 overflow-hidden">
                                    <div
                                        class="h-full bg-accent rounded-full transition-all group-hover:opacity-100"
                                        style={{
                                            width: `${Math.min(count * 10, 100)}%`,
                                            opacity: intensity,
                                        }}
                                    />
                                </div>
                            </Card>
                        );
                    })}
                </div>
            ) : (
                <Card padding="xl" class="text-center py-20 max-w-md mx-auto">
                    <Icon
                        name="tag"
                        class="size-10 mx-auto mb-4 text-muted-foreground"
                    />
                    <p class="text-xl text-muted-foreground">No tags</p>
                </Card>
            )
        }
    </Section>
</BaseLayout>
