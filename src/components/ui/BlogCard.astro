---
// src/components/ui/BlogCard.astro
import { Image } from "astro:assets";
import Card from "./Card.astro";
import { FormattedDate } from "@/components/basic";
import { Button } from "@/components/ui";

export interface Props {
    title: string;
    pubDate: Date;
    author?: string;
    position?: string;
    tags?: string[];
    heroImageLight?: ImageMetadata;
    heroImageDark?: ImageMetadata;
    excerpt?: string;
    href: string;
    class?: string;
}

const {
    title,
    pubDate,
    author = "miniyuan",
    position = "Jupyter",
    tags = [],
    heroImageLight,
    heroImageDark,
    excerpt,
    href,
    class: className = "",
} = Astro.props;

const hasImage = !!heroImageLight || !!heroImageDark;
const showTagMax = 1;
---

<article
    class:list={[
        "relative block w-full group hover:-translate-y-2 hover:shadow-lg transition-base",
        className,
    ]}
    aria-label={`Read blog: ${title}`}
>
    {/* Main Card Link - Pseudo-element provides full card clickability */}
    <a
        href={href}
        class:list={[
            "block no-underline text-inherit w-full relative cursor-pointer",
            "after:absolute after:inset-0 after:z-[1] after:content-[''] after:pointer-events-auto", // overlay to highlight the content
        ]}
        aria-label={title}
    >
        <Card
            padding="none"
            hover={false}
            class="relative w-full overflow-hidden rounded-xl"
        >
            {
                hasImage && (
                    <>
                        {/* Switch background image with theme changing */}
                        <div class="absolute inset-0 w-full h-full overflow-hidden">
                            {heroImageLight && (
                                <Image
                                    width={720}
                                    height={360}
                                    src={heroImageLight}
                                    alt={title}
                                    class="absolute inset-0 w-full h-full object-cover transition-transform group-hover:scale-105 dark:hidden"
                                />
                            )}
                            {heroImageDark && (
                                <Image
                                    width={720}
                                    height={360}
                                    src={heroImageDark}
                                    alt={title}
                                    class="absolute inset-0 w-full h-full object-cover transition-transform group-hover:scale-105 hidden dark:block"
                                />
                            )}
                        </div>
                        {/* Gradient Overlay for better text readability */}
                        <div class="absolute inset-0 bg-gradient-to-t from-background via-background/50 to-transparent transition-opacity" />
                    </>
                )
            }
            {/* Content Layer - Text content displayed above the image */}
            <div class="relative z-[2] flex flex-col justify-end h-full min-h-[320px] p-6 pt-0 gap-3">
                {/* Bottom Content */}
                <div class="flex flex-col gap-2">
                    <div class="flex-between gap-2 flex-wrap">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-semibold text-foreground">
                                {author}
                            </span>
                            {
                                position && (
                                    <span class="text-sm text-muted-foreground pl-2 border-l border-gray-light">
                                        {position}
                                    </span>
                                )
                            }
                        </div>
                        <time class="text-sm text-muted-foreground font-mono">
                            <FormattedDate date={pubDate} />
                        </time>
                    </div>

                    <h3 class="text-xl font-bold text-foreground line-clamp-2 leading-tight transition-colors group-hover:text-accent">{title}</h3>

                    {excerpt && <p class="text-base text-foreground/80 line-clamp-2 leading-relaxed">{excerpt}</p>}
                </div>
            </div>
        </Card>
    </a>

    {/* Top Row: Tags */}
    <div class="absolute top-0 left-0 right-0 z-10 flex flex-wrap gap-2 p-6 pointer-events-none">
        {
            tags
                .slice(0, showTagMax)
                .map((tag) => (
                    <Button
                        as="a"
                        href={`/tags/${encodeURIComponent(tag)}`}
                        variant="pill"
                        title={tag}
                        class="pointer-events-auto"
                    />
                ))
        }
        {
            tags.length > showTagMax && (
                <Button
                    as="span"
                    variant="pill"
                    title={`+${tags.length - showTagMax}`}
                    class="pointer-events-auto hover:cursor-pointer"
                />
            )
        }
    </div>
</article>
