---
// src/components/ui/BlogCard.astro
import { Image } from "astro:assets";
import Card from "./Card.astro";
import { FormattedDate } from "@/components/basic";
import { Button } from "@/components/ui";

export interface Props {
    title: string;
    pubDate: Date;
    author?: string;
    position?: string;
    tags?: string[];
    heroImageLight?: ImageMetadata;
    heroImageDark?: ImageMetadata;
    excerpt?: string;
    href: string;
    class?: string;
}

const {
    title,
    pubDate,
    author = "miniyuan",
    position = "Developer",
    tags = [],
    heroImageLight,
    heroImageDark,
    excerpt,
    href,
    class: className = "",
} = Astro.props;

const hasImage = !!heroImageLight || !!heroImageDark;
const showTagMax = 1;
---

<article
    class:list={[
        "blog-card-wrapper group hover:-translate-y-2 hover:shadow-lg transition-base", // positioning context
        className,
    ]}
    aria-label={`Read blog: ${title}`}
>
    {/* Main Card Link - Pseudo-element provides full card clickability */}
    <a
        href={href}
        class="blog-card-link blog-card-link-overlay"
        aria-label={title}
    >
        <Card
            padding="none"
            hover={false}
            class="relative w-full overflow-hidden rounded-xl"
        >
            {
                hasImage && (
                    <>
                        {/* Switch background image with theme changing */}
                        <div class="blog-card-bg-wrapper">
                            {heroImageLight && (
                                <Image
                                    width={720}
                                    height={360}
                                    src={heroImageLight}
                                    alt={title}
                                    class="blog-card-bg group-hover:scale-105 dark:hidden"
                                />
                            )}
                            {heroImageDark && (
                                <Image
                                    width={720}
                                    height={360}
                                    src={heroImageDark}
                                    alt={title}
                                    class="blog-card-bg group-hover:scale-105 hidden dark:block"
                                />
                            )}
                        </div>
                        {/* Gradient Overlay for better text readability */}
                        <div class="blog-card-overlay" />
                    </>
                )
            }
            {/* Content Layer - Text content displayed above the image */}
            <div class="blog-card-content blog-card-content-layer">
                {/* Bottom Content */}
                <div class="blog-card-footer">
                    <div class="blog-card-header">
                        <div class="flex items-center gap-2">
                            <span class="blog-card-author">
                                {author}
                            </span>
                            {
                                position && (
                                    <span class="blog-card-position">
                                        {position}
                                    </span>
                                )
                            }
                        </div>
                        <time class="blog-card-date">
                            <FormattedDate date={pubDate} />
                        </time>
                    </div>

                    <h3 class="blog-card-title">{title}</h3>

                    {excerpt && <p class="blog-card-excerpt">{excerpt}</p>}
                </div>
            </div>
        </Card>
    </a>

    {/* Top Row: Tags - Positioned above card link via z-index layering */}
    <div class="blog-card-tags">
        {
            tags
                .slice(0, showTagMax)
                .map((tag) => (
                    <Button
                        as="a"
                        href={`/tags/${encodeURIComponent(tag)}`}
                        variant="pill"
                        title={tag}
                        class="blog-card-tag-link"
                    />
                ))
        }
        {
            tags.length > showTagMax && (
                <Button
                    as="span"
                    variant="pill"
                    title={`+${tags.length - showTagMax}`}
                    class="blog-card-tag-more"
                />
            )
        }
    </div>
</article>
