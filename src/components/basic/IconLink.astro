---
// The <IconLink /> component creates consistent icon links

import { Icon } from "../ui";
import type { HTMLAttributes } from "astro/types";
import { type IconKey } from "../icons";

type Props = HTMLAttributes<"a"> & {
    href: string;
    label: string;
    icon: IconKey;
    isExternal?: boolean;
    isMobile?: boolean;
    delay?: string | number;
};

const {
    href,
    label,
    icon,
    isExternal = false,
    isMobile = false,
    delay,
    class: className,
    ...props
} = Astro.props;

const hrefString = String(href);
const isExternalLink = isExternal || hrefString.startsWith("http");

let isActive = false;
if (!isExternalLink) {
    const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
    const subpath = pathname.match(/[^\/]+/g);
    isActive = href === pathname || href === "/" + (subpath?.[0] || "");
}

const externalProps = isExternalLink
    ? { target: "_blank", rel: "noopener noreferrer" }
    : {};

// Build style object for animation delay
const styleObj: Record<string, string> = {};

if (delay !== undefined) {
    styleObj["animation-delay"] =
        typeof delay === "number" ? `${delay}ms` : delay;
}
---

<a
    href={href}
    aria-label={label}
    class:list={[
        className,
        !isMobile && "icon-button-base",
        isMobile && "mobile-menu-item-base",
        isActive && ["text-accent font-semibold", isMobile && "mobile-active-indicator"],
    ]}
    style={styleObj}
    aria-current={isActive ? "page" : undefined}
    {...externalProps}
    {...props}
>
    <Icon name={icon} class:list={["icon-base", isActive && "text-accent"]} />

    {!isMobile && <span class="sr-only">{label}</span>}
    {isMobile && <span class="inherent">{label}</span>}
    <slot />
</a>
